{
  "name": "Blockchain-Based Educational Credential Verification and Sharing System",
  "nodes": [
    {
      "parameters": {
        "mode": "manual",
        "workflowId": null,
        "triggerOnFlowStart": true
      },
      "name": "Start Workflow",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        250,
        300
      ]
    },
    {
      "parameters": {
        "operation": "create",
        "resource": "credential",
        "credentialData": {
          "json": {
            "studentName": "={{$json[\"studentName\"]}}",
            "studentID": "={{$json[\"studentID\"]}}",
            "institution": "={{$json[\"institution\"]}}",
            "degree": "={{$json[\"degree\"]}}",
            "fieldOfStudy": "={{$json[\"fieldOfStudy\"]}}",
            "dateAwarded": "={{$json[\"dateAwarded\"]}}",
            "credentialHash": "={{$json[\"credentialHash\"]}}"
          }
        }
      },
      "name": "Input Credential Data",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        500,
        300
      ]
    },
    {
      "parameters": {
        "operation": "invokeSmartContractFunction",
        "contractAddress": "={{$env.BLOCKCHAIN_CONTRACT_ADDRESS}}",
        "functionName": "verifyCredential",
        "functionParams": {
          "credentialHash": "={{$json[\"credentialHash\"]}}"
        },
        "returnType": "boolean",
        "chain": "Ethereum",
        "network": "mainnet"
      },
      "name": "Verify Credential On Blockchain",
      "type": "n8n-nodes-base.blockchainInvoke",
      "typeVersion": 1,
      "position": [
        750,
        300
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json[\"result\"]}}",
              "operation": "equal",
              "value2": true
            }
          ]
        }
      },
      "name": "Is Credential Verified?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        950,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "const credentialId = $json[\"credentialHash\"] || Date.now().toString();\nconst baseShareUrl = $env.SHARE_BASE_URL || \"https://credentials.example.com/share\";\n\n// Generate a unique, verifiable, and expiring share link\nconst expiryTime = Date.now() + 7 * 24 * 60 * 60 * 1000; // 7 days from now\n\nconst tokenPayload = {\n  credentialId,\n  expiryTime\n};\n\n// For simplicity, base64 encode as the token (in production use JWT or similar with signing)\nconst tokenString = Buffer.from(JSON.stringify(tokenPayload)).toString('base64');\n\nconst shareableLink = `${baseShareUrl}?token=${tokenString}`;\n\nreturn [{json: {shareableLink}}];"
      },
      "name": "Generate Shareable Verifiable Link",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1150,
        240
      ]
    },
    {
      "parameters": {
        "toEmail": "={{$json[\"employerEmail\"] || $json[\"institutionEmail\"]}}",
        "subject": "Educational Credential Verification Link",
        "text": "Hello,\n\nA verified educational credential has been shared with you.\nYou can review the credential at the following secure link:\n\n{{$json[\"shareableLink\"]}}\n\nThis link is valid for 7 days.\n\nBest regards,\nCredential Verification System"
      },
      "name": "Notify Employer/Institution",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 1,
      "position": [
        1350,
        240
      ]
    },
    {
      "parameters": {
        "functionCode": "return [{json: {error: \"Credential verification failed on blockchain.\"}}];"
      },
      "name": "Handle Verification Failure",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1150,
        360
      ]
    },
    {
      "parameters": {
        "operation": "send",
        "resource": "notification",
        "message": "Credential verification failed on blockchain for credentialHash: {{$json[\"credentialHash\"] || 'unknown'}}",
        "channel": "admin-alerts"
      },
      "name": "Notify Admin on Failure",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        1350,
        360
      ]
    }
  ],
  "connections": {
    "Start Workflow": {
      "main": [
        [
          {
            "node": "Input Credential Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Input Credential Data": {
      "main": [
        [
          {
            "node": "Verify Credential On Blockchain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verify Credential On Blockchain": {
      "main": [
        [
          {
            "node": "Is Credential Verified?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Credential Verified?": {
      "main": [
        [
          {
            "node": "Generate Shareable Verifiable Link",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Handle Verification Failure",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Shareable Verifiable Link": {
      "main": [
        [
          {
            "node": "Notify Employer/Institution",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Handle Verification Failure": {
      "main": [
        [
          {
            "node": "Notify Admin on Failure",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {},
  "id": "blockchain-credential-verification-workflow"
}