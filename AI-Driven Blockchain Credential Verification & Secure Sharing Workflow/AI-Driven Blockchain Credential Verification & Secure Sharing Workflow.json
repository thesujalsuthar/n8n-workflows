{
  "name": "AI-Powered Blockchain Educational Credential Verification & Secure Sharing",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "submit-credential",
        "responseMode": "lastNode",
        "options": {}
      },
      "name": "Receive Credential Submission",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        250,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "// Extract credential data from incoming request\nreturn [{ json: { credential: $json.credentialsData || $json } }];"
      },
      "name": "Extract Credential Data",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        450,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "/*\n  AI-powered validation simulation:\n  - Checks credential structure\n  - Calls to AI verification API can be added here\n*/\nconst credential = items[0].json.credential;\nlet verified = false;\nlet verificationDetails = {};\n\n// Example: Validate required fields\nif (credential && credential.studentId && credential.courseId && credential.issueDate) {\n  verified = true;\n  verificationDetails = {\n    status: 'verified',\n    verifiedAt: new Date().toISOString(),\n    notes: 'Credential data structure validated by AI module'\n  };\n} else {\n  verificationDetails = {\n    status: 'failed',\n    verifiedAt: new Date().toISOString(),\n    notes: 'Missing required fields in credential data'\n  };\n}\n\nreturn [{ json: { credential, verificationDetails } }];"
      },
      "name": "AI Credential Verification",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        650,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "const { credential, verificationDetails } = items[0].json;\n\nif (verificationDetails.status === 'verified') {\n  // Prepare the data to store on blockchain\n  return [{ json: { credential, verificationDetails, dataToStore: {\n    studentId: credential.studentId,\n    courseId: credential.courseId,\n    issueDate: credential.issueDate,\n    issuer: credential.issuer || 'Unknown Issuer',\n    verificationTimestamp: verificationDetails.verifiedAt\n  } } }];\n} else {\n  return [{ json: { error: 'Verification failed', verificationDetails } }];\n}"
      },
      "name": "Prepare Data for Blockchain",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        850,
        300
      ]
    },
    {
      "parameters": {
        "authentication": "bearer",
        "url": "https://your-blockchain-node/api/credentials/store",
        "method": "POST",
        "responseFormat": "json",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={{$json[\"dataToStore\"]}}",
        "headerParametersJson": "{\"Authorization\":\"Bearer YOUR_BLOCKCHAIN_API_TOKEN\",\"Content-Type\":\"application/json\"}"
      },
      "name": "Store Credential on Blockchain",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        1050,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "if (items[0].json && items[0].json.transactionId) {\n  return [{ json: { status: 'success', transactionId: items[0].json.transactionId } }];\n} else {\n  return [{ json: { status: 'error', message: 'Blockchain storage failed' } }];\n}"
      },
      "name": "Check Blockchain Storage Result",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1250,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "const status = items[0].json.status;\nif (status === 'success') {\n  return [{ json: { verified: true } }];\n} else {\n  return [{ json: { verified: false } }];\n}"
      },
      "name": "Is Verified?",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1450,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "/*\n Prepare secure sharing package with minimal info\n  - Encrypt or package data for authorized party\n  For demo: just pass through data\n*/\nreturn [{ json: { sharePackage: {\n  authorizedParty: 'university_admin@example.com',\n  credentialId: $items('Prepare Data for Blockchain')[0].json.dataToStore.studentId + '_' + $items('Prepare Data for Blockchain')[0].json.dataToStore.courseId,\n  verificationTimestamp: $items('Prepare Data for Blockchain')[0].json.dataToStore.verificationTimestamp,\n  blockchainTx: $items('Check Blockchain Storage Result')[0].json.transactionId\n}} }];"
      },
      "name": "Prepare Secure Sharing Package",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1650,
        200
      ]
    },
    {
      "parameters": {
        "fromEmail": "no-reply@education-blockchain.com",
        "toEmail": "={{$json.sharePackage.authorizedParty}}",
        "subject": "Verified Educational Credential Secure Sharing",
        "text": "Dear Authorized Party,\n\nA verified educational credential is available for your review.\n\nCredential ID: {{$json.sharePackage.credentialId}}\nVerification Timestamp: {{$json.sharePackage.verificationTimestamp}}\nBlockchain Transaction ID: {{$json.sharePackage.blockchainTx}}\n\nPlease use the secure platform to access the credential details.\n\nBest regards,\nEducation Blockchain Team"
      },
      "name": "Send Secure Sharing Email",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 1,
      "position": [
        1850,
        200
      ]
    },
    {
      "parameters": {
        "functionCode": "return [ { json: { \n  alertType: 'verification_failure',\n  message: 'Educational credential verification failed or storage failed.',\n  details: $json\n} } ];"
      },
      "name": "Prepare Alert on Failure",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1650,
        400
      ]
    },
    {
      "parameters": {
        "fromEmail": "alerts@education-blockchain.com",
        "toEmail": "admin@education-blockchain.com",
        "subject": "ALERT: Educational Credential Verification Failure",
        "text": "An educational credential verification or blockchain storage operation has failed.\n\nDetails:\n{{$json.details | json}}\n\nPlease investigate immediately."
      },
      "name": "Send Alert Email",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 1,
      "position": [
        1850,
        400
      ]
    }
  ],
  "connections": {
    "Receive Credential Submission": {
      "main": [
        [
          {
            "node": "Extract Credential Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Credential Data": {
      "main": [
        [
          {
            "node": "AI Credential Verification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Credential Verification": {
      "main": [
        [
          {
            "node": "Prepare Data for Blockchain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Data for Blockchain": {
      "main": [
        [
          {
            "node": "Store Credential on Blockchain",
            "type": "main",
            "index": 0,
            "condition": "={{!$json.error}}"
          },
          {
            "node": "Prepare Alert on Failure",
            "type": "main",
            "index": 0,
            "condition": "={{!!$json.error}}"
          }
        ]
      ]
    },
    "Store Credential on Blockchain": {
      "main": [
        [
          {
            "node": "Check Blockchain Storage Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Blockchain Storage Result": {
      "main": [
        [
          {
            "node": "Is Verified?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Verified?": {
      "main": [
        [
          {
            "node": "Prepare Secure Sharing Package",
            "type": "main",
            "index": 0,
            "condition": "={{$json.verified === true}}"
          },
          {
            "node": "Prepare Alert on Failure",
            "type": "main",
            "index": 0,
            "condition": "={{$json.verified === false}}"
          }
        ]
      ]
    },
    "Prepare Secure Sharing Package": {
      "main": [
        [
          {
            "node": "Send Secure Sharing Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Alert on Failure": {
      "main": [
        [
          {
            "node": "Send Alert Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}