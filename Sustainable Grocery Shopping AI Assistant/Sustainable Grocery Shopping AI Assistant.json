{
  "name": "AI-Driven Sustainable Grocery Shopping Assistant",
  "nodes": [
    {
      "parameters": {
        "authentication": "headerAuth",
        "httpMethod": "POST",
        "url": "https://api.openai.com/v1/chat/completions",
        "options": {},
        "bodyParametersUi": {
          "enabled": true,
          "parameter": [
            {
              "name": "model",
              "value": "gpt-4"
            },
            {
              "name": "messages",
              "value": "={{[{\"role\":\"system\",\"content\":\"You are an assistant that suggests sustainable and eco-friendly alternatives to grocery products given a user's shopping list. For each item, provide 1-2 eco-friendly alternative product names along with brief reasons.\"},{\"role\":\"user\",\"content\":\"User shopping list: \" + JSON.stringify($json[\"shoppingList\"])}]}}"
            },
            {
              "name": "temperature",
              "value": 0.7
            }
          ]
        },
        "headerParametersUi": {
          "parameter": [
            {
              "name": "Authorization",
              "value": "Bearer {{$credentials.openaiApi.key}}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        }
      },
      "name": "Get Sustainable Alternatives",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        450,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "const alternativesText = $json.choices[0].message.content;\n// Parse the alternatives assuming AI returns JSON array or fallback to raw text\ntry {\n  return [{ json: JSON.parse(alternativesText) }];\n} catch (error) {\n  return [{ json: { alternativesRaw: alternativesText } }];\n}"
      },
      "name": "Parse Alternatives",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        700,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "/* Calculate estimated carbon footprint savings by comparing original items and alternatives.\n   For demo purpose, assign random savings values per item. */\n\nconst alternatives = items[0].json;\nconst shoppingList = $json.shoppingList || [];\n\nlet totalSavings = 0;\n\nfor (const item of shoppingList) {\n  // Random estimated savings between 0.1 to 0.5 kg CO2 per item replaced\n  totalSavings += 0.3;\n}\n\n// Store savings rounded to 2 decimals\nreturn [{ json: { totalCarbonSavingsKgCO2: totalSavings.toFixed(2) } }];"
      },
      "name": "Calculate Carbon Savings",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        950,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "/* Simulate fetching product availability and pricing from local stores.\n   Input: array of eco-friendly alternatives.\n   Output: map each alternative to store info with price and availability (randomized).\n*/\n\nconst alternatives = $items(\"Parse Alternatives\")[0].json;\nlet products = [];\n\n// If alternativesRaw fallback: just output empty array\nif (alternatives.alternativesRaw) {\n  return [{ json: { storeProducts: [] } }];\n}\n\nfor (const alt of alternatives) {\n  const productName = alt.name || alt;\n  products.push({\n    name: productName,\n    store: \"Local Green Market\",\n    priceUSD: (Math.random() * 5 + 1).toFixed(2),\n    available: Math.random() > 0.2\n  });\n}\n\nreturn [{ json: { storeProducts: products } }];"
      },
      "name": "Fetch Store Availability & Pricing",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1200,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "return [{\n  json: {\n    message: `Here are your sustainable alternatives with their availability and prices in local stores, plus your estimated carbon footprint savings of ${$json.totalCarbonSavingsKgCO2} kg CO2.`,\n    alternatives: $items(\"Parse Alternatives\")[0].json,\n    storeProducts: $json.storeProducts,\n    carbonSavingsKgCO2: $json.totalCarbonSavingsKgCO2\n  }\n}];"
      },
      "name": "Compose Final Output",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1450,
        300
      ]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "shoppingList",
              "value": "[]"
            }
          ]
        },
        "options": {}
      },
      "name": "Start - Receive Shopping List",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        200,
        300
      ]
    }
  ],
  "connections": {
    "Start - Receive Shopping List": {
      "main": [
        [
          {
            "node": "Get Sustainable Alternatives",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Sustainable Alternatives": {
      "main": [
        [
          {
            "node": "Parse Alternatives",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Alternatives": {
      "main": [
        [
          {
            "node": "Calculate Carbon Savings",
            "type": "main",
            "index": 0
          },
          {
            "node": "Fetch Store Availability & Pricing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate Carbon Savings": {
      "main": [
        [
          {
            "node": "Compose Final Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Store Availability & Pricing": {
      "main": [
        [
          {
            "node": "Compose Final Output",
            "type": "main",
            "index": 1
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {},
  "id": "1"
}