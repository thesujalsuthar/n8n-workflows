# Cryptocurrency Portfolio Risk Management and Alert System

This workflow provides an automated system to monitor the risk level of a cryptocurrency portfolio by fetching market data, calculating risk metrics, evaluating portfolio volatility against a predefined threshold, and sending email alerts when risk levels change.

---

## Workflow Overview

- Runs **four times daily** at 00:00, 06:00, 12:00, and 18:00.
- Fetches latest cryptocurrency prices from the CoinMarketCap API.
- Uses user-defined parameters including portfolio holdings and risk threshold.
- Calculates portfolio value and volatility based on mock volatility and correlation data.
- Generates risk alerts if portfolio volatility exceeds the threshold.
- Sends email notifications with the risk status.

---

## Workflow Nodes

### 1. Scheduled Trigger
- **Type:** Schedule Trigger
- **Schedule:** Executes every day at 00:00, 06:00, 12:00, 18:00.
- **Purpose:** Triggers the workflow to run at the specified times.

### 2. User Parameters
- **Type:** Set
- **Parameters:**
  - **`riskThreshold` (number):** The maximum acceptable portfolio volatility (default `0.05` or 5%).
  - **`symbols` (string):** Comma-separated list of cryptocurrency symbols to monitor (default `"BTC,ETH,ADA,BNB"`).
- **Purpose:** Defines user-configurable parameters for portfolio risk evaluation.

### 3. Fetch Market Data
- **Type:** HTTP Request
- **API:** CoinMarketCap Pro API `/v1/cryptocurrency/quotes/latest`
- **Authentication:** API Key (CoinMarketCap Pro)
- **Request details:**
  - Query parameter `symbol` dynamically constructed from the list of symbols.
  - Header includes `X-CMC_PRO_API_KEY`.
- **Purpose:** Retrieves the latest USD price quotes for specified cryptocurrencies.

### 4. Calculate Risk Metrics
- **Type:** Function
- **Functionality:**
  - Parses fetched market data to extract current prices.
  - Defines a fixed portfolio with holdings:
    - BTC: 0.5
    - ETH: 5
    - ADA: 1000
    - BNB: 10
  - Calculates total portfolio value.
  - Uses predefined mock volatilities and correlations among assets.
  - Computes portfolio weights and portfolio variance.
  - Calculates portfolio volatility (standard deviation).
  - Outputs portfolio value, portfolio volatility, and user-defined risk threshold.
- **Purpose:** Computes key portfolio risk metrics used in decision making.

### 5. Evaluate Risk and Generate Alerts
- **Type:** Function
- **Functionality:**
  - Compares calculated portfolio volatility with the risk threshold.
  - Generates alert messages:
    - **HIGH RISK:** Volatility exceeds threshold.
    - **NORMAL:** Volatility is within acceptable limits.
- **Output:** Alert level and detailed message for notification.
- **Purpose:** Determines risk status and prepares alert content.

### 6. Send Email Alert
- **Type:** Email Send
- **Parameters:**
  - **From Email:** `alerts@cryptoriskmanager.com`
  - **To Email:** User configurable via input or defaults to `user@example.com`.
  - **Subject:** "Cryptocurrency Portfolio Risk Alert"
  - **Body:** Alert message generated by risk evaluation node.
- **Credentials:** SMTP Email configuration required.
- **Purpose:** Sends email notifications to the user with the portfolio risk status.

---

## Configuration Instructions

1. **CoinMarketCap API Setup**
   - Obtain a CoinMarketCap Pro API key.
   - Add API credentials in the workflow's credentials section with the name `CoinMarketCap API`.

2. **SMTP Email Setup**
   - Configure SMTP credentials for sending email alerts.
   - Add SMTP email credentials under the name `SMTP Email`.

3. **User Parameters Adjustment**
   - Modify the `User Parameters` node to update:
     - `riskThreshold`: change the acceptable portfolio volatility threshold.
     - `symbols`: update cryptocurrencies to track.

4. **Portfolio Holdings Update**
   - Update the portfolio asset quantities inside the `Calculate Risk Metrics` function node as needed.

5. **Email Recipient Configuration**
   - By default, alerts are sent to `user@example.com`.
   - To dynamically specify the recipient email, include an `email` field in the workflow input data or modify the node as appropriate.

---

## How It Works Step-by-Step

1. At scheduled times, the workflow triggers automatically.
2. User parameters are set defining which cryptocurrencies to monitor and the risk threshold.
3. Latest market data is fetched from CoinMarketCap for the specified assets.
4. Portfolio value and volatility are calculated using current prices and predefined risk assumptions.
5. The calculated volatility is compared with the threshold.
6. An alert message is generated based on the comparison.
7. An email with the alert message is sent to notify the user.

---

## Notes

- The volatility and correlation data are static mock values for demonstration. In a production system, these should be replaced with real historical volatility and correlation computations.
- Portfolio asset holdings are hardcoded within the function node and should be updated or sourced dynamically for real use cases.
- Risk evaluation logic can be extended to include value-at-risk or other advanced metrics.
- Scheduled triggers ensure continuous monitoring without manual intervention.

---

This system helps users maintain oversight of their cryptocurrency portfolio risk, enabling proactive portfolio management and timely alerts.